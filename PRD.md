# 产品需求文档 (PRD): EduQR Lite - 简易作业二维码生成器

**版本**: v1.1
**最后更新**: 2026-02-08
**项目类型**: MVP 教育工具
**部署方式**: Docker + Tencent Lighthouse

---

## 1. 产品概述

### 1.1 项目背景
普通二维码生成工具（如"草料二维码"）在处理长文本时会产生过度密集的二维码，导致扫描困难。教师布置作业时，常需要包含阅读材料、详细说明等长篇内容，传统静态二维码无法满足需求。

### 1.2 产品定位
一个**极简、无广告、私有化部署**的作业二维码生成工具，专为教育场景设计。支持三种模式：
- **静态码**：短文本直接编码
- **活码**：长文本托管，二维码指向可访问页面
- **听力作业**：支持音频文件上传 + 题目文本，二维码指向带播放器的页面

### 1.3 核心价值主张
- ✅ 无广告、无注册、无隐私收集
- ✅ 长作业轻松扫码查看
- ✅ **支持听力作业，音频文件直连播放**
- ✅ 移动端友好展示
- ✅ 一键 Docker 部署，数据完全自主掌控

---

## 2. 用户故事

### 故事 1：布置阅读作业（活码场景）

**角色**: 张老师（初中语文教师）

**背景**:
张老师需要布置一篇 800 字的阅读材料作业，包含文章原文和 3 个思考题。

**用户旅程**:
```
1. 张老师打开 EduQR 网站
2. 输入预设的管理暗号
3. 在左侧编辑器粘贴作业内容（包含文章和题目）
4. 选择"活码模式"（系统提示当前 1200 字符，建议使用活码）
5. 点击"生成二维码"
6. 右侧实时预览二维码
7. 下载 PNG 图片，插入到 PPT 中
8. 第二天课堂上，学生用手机扫码即可看到完整的作业内容
```

**成功标准**:
- 二维码清晰可扫（密度适中）
- 学生扫码后看到排版整洁的作业内容
- 无需学生安装任何 APP

---

### 故事 2：快速分享 Wi-Fi 密码（静态码场景）

**角色**: 李老师（小学信息技术课教师）

**背景**:
学生需要连接实验室 Wi-Fi 完成上机操作，李老师需要在屏幕上快速展示密码。

**用户旅程**:
```
1. 李老师打开 EduQR
2. 输入管理暗号
3. 选择"静态码模式"
4. 输入简短文本："Wi-Fi: Lab_2026  密码: avic123456"
5. 点击生成
6. 截图展示给学生
7. 学生扫码后直接看到密码信息
```

**成功标准**:
- 生成速度快（< 1 秒）
- 二维码可离线扫描（无需网络访问服务器）

---

### 故事 3：学生查看作业（移动端体验）

**角色**: 王小明（八年级学生）

**背景**:
放学时老师布置了作业，小明用手机扫码查看具体内容。

**用户旅程**:
```
1. 小明打开微信/相机扫描老师提供的二维码
2. 自动跳转到作业详情页（无需登录）
3. 看到清晰的作业标题和正文
4. 文中包含的链接可直接点击跳转
5. 长按页面可复制全部内容
```

**成功标准**:
- 页面加载快速（< 2 秒）
- 文字大小适合阅读（16px+）
- 链接可直接点击
- 页面在微信/浏览器中均正常显示

---

### 故事 4：数据清理与维护

**角色**: 系统管理员

**背景**:
服务器运行 3 个月，需要清理过期作业数据释放存储空间。

**用户旅程**:
```
1. Docker 容器重启时自动执行清理脚本
2. 删除创建时间超过 30 天的作业记录
3. 同时删除关联的音频文件（释放磁盘空间）
4. 保留最近 30 天的数据供查询
5. 无需人工干预
```

**成功标准**:
- 数据库文件不会无限增长
- 音频文件随作业记录同步删除
- 清理过程不影响正在使用的服务

---

### 故事 5：布置听力作业（音频文件场景）

**角色**: 赵老师（高中英语教师）

**背景**:
赵老师需要布置英语听力作业，包含一段 3 分钟的听力音频和 5 道听力理解题。

**用户旅程**:
```
1. 赵老师打开 EduQR 网站
2. 输入管理暗号
3. 选择"活码模式"
4. 点击"上传音频"按钮，选择电脑中的 listening_test.mp3 文件
5. 等待上传完成（显示进度条和文件大小）
6. 在文本框输入题目内容：
   "听力题目：根据音频内容回答以下问题..."
7. 点击"生成二维码"
8. 右侧预览二维码
9. 下载并分享到班级群
10. 学生扫码后，在手机上直接点击播放器收听音频并查看题目
```

**成功标准**:
- 支持 MP3/WAV/M4A 等常见音频格式
- 单个文件 < 20MB（一首歌的大小）
- 上传进度实时显示
- 学生扫码后可直接在浏览器播放音频（无需下载）
- 音频文件随作业自动过期清理

---

## 3. 功能需求

### 3.1 核心功能模块

#### 3.1.1 输入与编辑区

| 功能 | 描述 | 优先级 |
|------|------|--------|
| 模式切换 | Tab 切换：静态码 / 活码 / 听力作业 | P0 |
| 内容输入 | 多行文本框，支持 10,000 字符 | P0 |
| 字符计数 | 实时显示当前字符数，并提示推荐模式 | P0 |
| 管理暗号验证 | 输入框验证 `ADMIN_PASSWORD` 环境变量 | P0 |
| 音频上传 | 仅"听力作业"模式显示，支持 MP3/WAV/M4A，最大 20MB | P0 |
| 上传进度 | 显示上传进度条和文件大小 | P0 |
| 文件预览 | 上传后显示音频播放器预览 | P0 |

**模式推荐逻辑**：
```
字符数 ≤ 300  → 推荐静态码
字符数 > 300  → 推荐活码
需要音频      → 使用听力作业模式
```

#### 3.1.2 二维码配置

| 功能 | 描述 | 优先级 |
|------|------|--------|
| 容错率选择 | 下拉选择：L(7%) / M(15%) / Q(25%) / H(30%)，默认 M | P0 |
| 尺寸设置 | 数字输入：200-1000px，默认 300px | P0 |
| 实时预览 | 右侧卡片实时显示生成的二维码 | P0 |

#### 3.1.3 下载与导出

| 功能 | 描述 | 优先级 |
|------|------|--------|
| PNG 下载 | 一键下载二维码图片，文件名格式：`作业_20260208_1430.png` | P0 |
| 嵌入复制 | 复制 HTML `<img>` 标签（可选，v2.0） | P2 |

---

### 3.2 活码展示页（移动端）

#### 路由规则
```
/static/v/{short_id}  → 作业详情页
```

#### 页面元素

| 元素 | 描述 | 优先级 |
|------|------|--------|
| 页面标题 | 自动提取首行内容（前 30 字）或默认"今日作业" | P0 |
| 正文内容 | 支持换行、链接点击 | P0 |
| 基础格式 | 支持加粗 `**text**`、列表 `- item`、标题 `#` | P0 |
| 音频播放器 | 听力作业模式显示 HTML5 audio 播放器 | P0 |
| 页脚 | "由 EduQR 生成"，灰色小字 | P1 |
| 时间戳 | 显示作业创建时间（如"2026年2月8日 发布"） | P1 |

**音频播放器规范**：
```html
<!-- 移动端友好的音频播放器 -->
<audio controls preload="metadata" style="width: 100%; max-width: 400px;">
  <source src="/static/uploads/{filename}" type="audio/mpeg">
  您的浏览器不支持音频播放
</audio>
```

#### 样式规范
```css
/* 移动端友好 */
- 最小字号：16px
- 行间距：1.6
- 内边距：20px
- 最大宽度：600px（大屏居中）
```

---

### 3.3 系统管理与安全

#### 3.3.1 访问控制

| 功能 | 描述 | 优先级 |
|------|------|--------|
| 创建保护 | 生成二维码需要验证 `ADMIN_PASSWORD` | P0 |
| 查看公开 | 学生扫码查看作业无需密码 | P0 |
| 暗号错误提示 | "暗号错误，请联系教师获取"（不泄露系统信息） | P0 |

#### 3.3.2 数据管理

| 功能 | 描述 | 优先级 |
|------|------|--------|
| 自动清理 | 启动时删除超过 `DATA_RETENTION_DAYS` 天的记录，默认 30 天 | P1 |
| 备份 | SQLite 文件挂载到 Docker volume，支持手动备份 | P0 |

---

## 4. 技术架构

### 4.1 技术栈

```
前端：HTML5 + TailwindCSS (CDN)
后端：Python FastAPI
数据库：SQLite
二维码：qrcode Python 库
部署：Docker + Docker Compose
```

### 4.2 核心设计决策

| 决策点 | 方案 | 理由 |
|--------|------|------|
| 静态/活码切换 | **手动 Tab + 智能提示** | 保持用户控制权，降低误操作 |
| 短 ID 策略 | **8 位随机字符**（可扩展至 12 位） | 平衡可读性与碰撞率，64^8 = 281 万亿组合 |
| Markdown 支持 | **基础语法**（换行、链接、加粗、列表、标题） | 满足作业排版需求，避免复杂度 |
| 数据清理 | **环境变量配置天数，启动时清理** | 可控、简单、不影响运行时性能 |
| 二维码自定义 | **MVP 仅尺寸 + 容错率** | 核心功能优先，颜色/logo 后续扩展 |

### 4.3 文件结构

```
/app
├── main.py              # FastAPI 应用入口
├── models.py            # SQLite 数据模型
├── utils.py             # 二维码生成工具函数
├── templates/
│   ├── index.html       # 创建器页面（桌面端优先）
│   └── view.html        # 作业展示页（移动端优先）
├── static/
│   ├── uploads/         # 音频文件存储目录
│   │   └── YYYY/MM/     # 按日期组织
│   └── output/          # 临时二维码缓存（可选）
├── Dockerfile           # Docker 镜像定义
├── docker-compose.yml   # 编排配置
├── requirements.txt     # Python 依赖
└── .env                 # 环境变量（不提交到 Git）
```

### 4.4 数据模型

```sql
CREATE TABLE homework_items (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    short_id VARCHAR(12) UNIQUE NOT NULL,      -- 8 位短码
    content TEXT NOT NULL,                       -- 作业内容（Markdown）
    title VARCHAR(100),                          -- 自动提取的首行
    audio_path VARCHAR(255),                     -- 音频文件路径（可选）
    audio_filename VARCHAR(100),                 -- 原始文件名（可选）
    audio_size INTEGER,                          -- 文件大小（字节）
    homework_type VARCHAR(20) DEFAULT 'text',    -- 'text' 或 'listening'
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    expires_at TIMESTAMP NULL                    -- 扩展字段，预留
);
```

**文件存储方案**：
```
/app/static/uploads/
├── 2026/
│   ├── 02/
│   │   ├── abc123_audio.mp3    -- 按日期目录组织
│   │   └── xyz789_listening.m4a
│   └── 03/
└── temp/                          -- 临时上传目录
```

**Docker Volume 挂载**：
```yaml
volumes:
  - ./data:/app/data              # SQLite 数据库
  - ./uploads:/app/static/uploads # 音频文件持久化
```

---

## 5. 界面原型

### 5.1 创建器页面（桌面端）

```
┌─────────────────────────────────────────────────────────────┐
│                    EduQR Lite - 作业二维码生成器              │
├─────────────────────────────┬───────────────────────────────┤
│  [静态码] [活码] [听力作业]  │                               │
│                             │                               │
│  管理暗号: [________________]  │     ┌───────────────────┐  │
│                             │     │                     │  │
│  ┌─────────────────────┐    │     │                     │  │
│  │ 📁 上传音频文件      │    │     │                     │  │
│  │   (MP3/WAV/M4A)     │    │     │     二维码预览       │  │
│  └─────────────────────┘    │     │                     │  │
│  上传进度: ████████ 100%    │     │                     │  │
│  文件: listening.mp3 (3.2MB)│     └───────────────────┘  │
│                             │                               │
│  作业内容:                  │   容错率: [M ▼]               │
│  ┌───────────────────────┐ │   尺寸:   [300] px            │
│  │ 听力题目：            │ │                               │
│  │ 1. 音频主要讲了什么？ │ │   [下载 PNG]                  │
│  │ 2. 作者的观点是？      │ │                               │
│  └───────────────────────┘ │                               │
│  [生成二维码]               │                               │
└─────────────────────────────┴───────────────────────────────┘
```

### 5.2 作业展示页（移动端 - 普通文本）

```
┌─────────────────────┐
│   《阅读理解作业》    │  ← 标题（自动提取）
├─────────────────────┤
│                     │
│ 请阅读以下文章...    │  ← 正文内容
│                     │
│ 1. 文章主题是？      │  ← 支持列表
│ 2. 作者观点是？      │
│                     │
│ 相关链接: [点击]     │  ← 可点击链接
│                     │
├─────────────────────┤
│ 2026年2月8日 发布   │  ← 时间戳
│ 由 EduQR 生成       │  ← 页脚
└─────────────────────┘
```

### 5.3 听力作业展示页（移动端 - 含音频）

```
┌─────────────────────┐
│  《英语听力作业》    │
├─────────────────────┤
│                     │
│  ▶️ ━━━━━●━━━━  3:24│  ← 音频播放器
│                     │
│ 听力题目：          │
│                     │
│ 请根据音频内容回答： │  ← 正文内容
│                     │
│ 1. 对话发生在哪里？  │
│ 2. Tom 打算做什么？  │
│ 3. 为什么改变计划？  │
│                     │
├─────────────────────┤
│ 2026年2月8日 发布   │
│ 由 EduQR 生成       │
└─────────────────────┘
```

---

## 6. 环境变量配置

| 变量名 | 必填 | 默认值 | 说明 |
|--------|------|--------|------|
| `ADMIN_PASSWORD` | ✅ | - | 创建二维码的管理暗号 |
| `BASE_URL` | ✅ | `http://localhost:8000` | 活码完整 URL 前缀 |
| `DATA_RETENTION_DAYS` | ❌ | `30` | 数据保留天数 |
| `MAX_CONTENT_LENGTH` | ❌ | `10000` | 最大字符数限制 |
| `MAX_UPLOAD_SIZE_MB` | ❌ | `20` | 单个音频文件最大大小（MB） |
| `ALLOWED_AUDIO_EXTENSIONS` | ❌ | `mp3,wav,m4a,ogg` | 允许的音频文件扩展名 |
| `QR_CODE_SIZE` | ❌ | `300` | 默认二维码尺寸（px） |
| `QR_ERROR_CORRECTION` | ❌ | `M` | 默认容错率（L/M/Q/H） |

**示例 .env 文件**:
```bash
ADMIN_PASSWORD=Avic2026!
BASE_URL=http://123.45.67.89
DATA_RETENTION_DAYS=30
MAX_UPLOAD_SIZE_MB=20
```

---

## 7. 非功能性需求

| 需求类型 | 指标 | 说明 |
|----------|------|------|
| 性能 | 生成时间 < 2s | 普通作业二维码生成响应时间 |
| 兼容性 | iOS/Android 微信、浏览器 | 学生扫码后页面正常显示 |
| 可用性 | 99%+ | 私有部署，基础可用性 |
| 安全性 | 禁止目录遍历、SQL 注入 | FastAPI 自动防护 + 参数验证 |
| 可维护性 | 单文件数据库 | SQLite 直接拷贝即可备份 |

---

## 8. 成功指标

### 8.1 技术指标
- ✅ Docker 容器启动时间 < 10 秒
- ✅ 二维码生成成功率 > 99%
- ✅ 移动端页面加载 < 2 秒（4G 网络）

### 8.2 用户体验指标
- ✅ 从打开网站到下载二维码 < 30 秒
- ✅ 学生扫码成功率 > 95%（不同设备/网络）
- ✅ 无需用户手册即可完成操作

---

## 9. 开发里程碑

### Phase 1: MVP 核心功能（Week 1）
- [x] PRD 文档确认
- [ ] FastAPI 后端框架搭建
- [ ] 静态码/活码双模式实现
- [ ] 基础 UI（TailwindCSS）
- [ ] Docker 部署配置

### Phase 2: 体验优化（Week 2）
- [ ] 移动端作业详情页
- [ ] 数据自动清理逻辑
- [ ] 错误处理与用户提示

### Phase 3: 扩展功能（可选）
- [ ] 二维码颜色自定义
- [ ] 作业编辑/删除功能
- [ ] 扫描统计（查看次数）

---

## 10. 风险与限制

### 10.1 已知风险
| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| 短 ID 碰撞 | 两个作业获得相同 ID | 8 位随机码碰撞率极低，且数据库 UNIQUE 约束会报错重试 |
| 服务器宕机 | 活码无法访问 | Docker auto-restart + 定期备份 SQLite |
| 恶意滥用 | 有人暴力破解暗号 | 速率限制（v2.0）+ 复杂密码要求 |

### 10.2 功能限制
- 不支持富文本编辑器（纯文本 + Markdown）
- **仅支持音频文件上传**（MP3/WAV/M4A），不支持图片/PDF/视频
- 不支持用户注册系统（单管理员模式）
- 不支持二维码扫描统计（MVP 阶段）
- 音频文件存储在本地，需定期监控磁盘空间

### 10.3 存储管理
- 音频文件按日期目录组织（`/uploads/YYYY/MM/`）
- 删除作业记录时同步删除关联音频文件
- 数据清理脚本会删除过期数据库记录和对应的音频文件
- 建议定期备份 `./uploads` 目录和 `./data/data.db` 文件

---

## 11. 下一步行动

**需要您确认**:
1. ✅ 用户故事是否覆盖了您的使用场景？
2. ✅ 功能边界是否清晰（MVP 做什么、不做什么）？
3. ✅ 技术方案是否满足您的部署需求？

**确认后我将开始**:
- 生成完整的 FastAPI 后端代码
- 编写 TailwindCSS 前端模板
- 配置 Docker 部署文件
- 提供本地测试指南

---

**文档版本历史**:
- v1.1 (2026-02-08): 新增听力作业场景，支持音频文件上传和播放
- v1.0 (2026-02-08): 初版 PRD，包含用户故事和技术架构
