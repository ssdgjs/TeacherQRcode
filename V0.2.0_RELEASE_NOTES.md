# ğŸ‰ v0.2.0 - é¢åº¦ç®¡ç†ç³»ç»Ÿ

## âœ… å®Œæˆæƒ…å†µ

### æ•°æ®åº“å±‚
- quotasè¡¨åˆ›å»ºï¼ˆç”¨æˆ·é¢åº¦ç®¡ç†ï¼‰
  - user_id: ç”¨æˆ·ID
  - free_used_today: ä»Šæ—¥å·²ç”¨å…è´¹æ¬¡æ•°
  - free_reset_date: ä¸Šæ¬¡é‡ç½®æ—¥æœŸ
  - purchased_count: å·²è´­ä¹°æ¬¡æ•°
  - subscription_expires_at: è®¢é˜…åˆ°æœŸæ—¶é—´
  - updated_at: æ›´æ–°æ—¶é—´

- ordersè¡¨åˆ›å»ºï¼ˆè®¢å•è®°å½•ï¼‰
  - user_id: ç”¨æˆ·ID
  - order_no: è®¢å•å·ï¼ˆå”¯ä¸€ï¼‰
  - type: è®¢å•ç±»å‹ï¼ˆpackage/subscriptionï¼‰
  - amount: é‡‘é¢ï¼ˆåˆ†ï¼‰
  - status: è®¢å•çŠ¶æ€ï¼ˆpending/paid/cancelledï¼‰
  - wechat_prepay_id: å¾®ä¿¡æ”¯ä»˜é¢„æ”¯ä»˜ID
  - created_at: åˆ›å»ºæ—¶é—´
  - paid_at: æ”¯ä»˜æ—¶é—´

### é¢åº¦ç®¡ç†é€»è¾‘
- **å…è´¹é¢åº¦**ï¼šæ¯å¤©10æ¬¡ï¼Œå‡Œæ™¨0ç‚¹é‡ç½®
- **è´­ä¹°æ¬¡æ•°**ï¼š100æ¬¡/Â¥9.9ï¼Œæ°¸ä¹…æœ‰æ•ˆ
- **æœˆå¡è®¢é˜…**ï¼šÂ¥9.9/æœˆï¼Œæ— é™æ¬¡ä½¿ç”¨
- **ä¼˜å…ˆçº§**ï¼šè®¢é˜… > è´­ä¹°æ¬¡æ•° > å…è´¹æ¬¡æ•°

### APIç«¯ç‚¹
- `GET /api/v1/quota` - æŸ¥è¯¢é¢åº¦ä¿¡æ¯
- `POST /api/v1/quota/consume` - æ¶ˆè´¹é¢åº¦ï¼ˆAIç”Ÿæˆæ—¶è°ƒç”¨ï¼‰
- `GET /api/v1/scheduler/info` - æŸ¥è¯¢å®šæ—¶ä»»åŠ¡çŠ¶æ€

### å®šæ—¶ä»»åŠ¡
- æ¯æ—¥0:00è‡ªåŠ¨é‡ç½®æ‰€æœ‰ç”¨æˆ·çš„å…è´¹æ¬¡æ•°
- æ¯æ—¥1:00æ¸…ç†è¿‡æœŸä½œä¸šï¼ˆå·²æœ‰åŠŸèƒ½ï¼‰

### å‰ç«¯æ›´æ–°
- é¦–é¡µå¤´éƒ¨æ˜¾ç¤ºé¢åº¦ä¿¡æ¯
  - å…è´¹æ¬¡æ•°ï¼šX/10
  - è´­ä¹°æ¬¡æ•°ï¼šXXæ¬¡
  - è®¢é˜…çŠ¶æ€ï¼šâ­æœˆå¡æœ‰æ•ˆæœŸè‡³XXæœˆXXæ—¥
- æœªç™»å½•æ—¶è‡ªåŠ¨éšè—

---

## ğŸš€ å¿«é€Ÿæµ‹è¯•

### 1. å¯åŠ¨æœåŠ¡

```bash
# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# å¯åŠ¨æœåŠ¡
docker-compose up -d --build

# è¿è¡Œæ•°æ®åº“è¿ç§»
docker-compose exec web alembic upgrade head
```

### 2. æµ‹è¯•æµç¨‹

**æ­¥éª¤1ï¼šæ³¨å†Œæ–°ç”¨æˆ·**
- è®¿é—®ï¼šhttp://localhost:8000/register
- æ³¨å†Œæ–°è´¦å·
- âœ… æ³¨å†Œåè‡ªåŠ¨åˆ›å»ºé¢åº¦è®°å½•ï¼ˆ10æ¬¡å…è´¹ï¼‰

**æ­¥éª¤2ï¼šæŸ¥çœ‹é¢åº¦**
- ç™»å½•åè®¿é—®é¦–é¡µ
- æŸ¥çœ‹å³ä¸Šè§’é¢åº¦æ˜¾ç¤º
- âœ… åº”æ˜¾ç¤ºï¼šå…è´¹: 10/10

**æ­¥éª¤3ï¼šæŸ¥è¯¢é¢åº¦API**
```bash
# å…ˆç™»å½•è·å–token
TOKEN=$(curl -X POST http://localhost:8000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"test1234"}' \
  | jq -r '.data.token')

# æŸ¥è¯¢é¢åº¦
curl -X GET http://localhost:8000/api/v1/quota \
  -H "Authorization: Bearer $TOKEN"

# é¢„æœŸå“åº”ï¼š
# {
#   "success": true,
#   "data": {
#     "free_used_today": 0,
#     "free_limit": 10,
#     "purchased_count": 0,
#     "is_subscriber": false,
#     "subscription_expires_at": null
#   }
# }
```

**æ­¥éª¤4ï¼šæµ‹è¯•é¢åº¦æ¶ˆè´¹**
```bash
# æ¶ˆè´¹1æ¬¡é¢åº¦
curl -X POST http://localhost:8000/api/v1/quota/consume \
  -H "Authorization: Bearer $TOKEN"

# é¢„æœŸå“åº”ï¼š
# {
#   "success": true,
#   "data": {
#     "consume_type": "free",
#     "remaining": 9,
#     "free_used_today": 1,
#     ...
#   }
# }

# å†æ¬¡æŸ¥è¯¢é¢åº¦
curl -X GET http://localhost:8000/api/v1/quota \
  -H "Authorization: Bearer $TOKEN"

# free_used_today åº”è¯¥æ˜¯ 1
```

**æ­¥éª¤5ï¼šæµ‹è¯•é¢åº¦ä¸è¶³**
```bash
# æ¶ˆè´¹10æ¬¡åï¼ˆå¾ªç¯è°ƒç”¨ï¼‰
for i in {1..10}; do
  curl -X POST http://localhost:8000/api/v1/quota/consume \
    -H "Authorization: Bearer $TOKEN"
done

# ç¬¬11æ¬¡åº”è¯¥è¿”å›403
curl -X POST http://localhost:8000/api/v1/quota/consume \
  -H "Authorization: Bearer $TOKEN"

# é¢„æœŸå“åº”ï¼š403 Forbidden
# {"detail": "ä»Šæ—¥å…è´¹æ¬¡æ•°å·²ç”¨å®Œï¼Œè¯·è´­ä¹°æ¬¡æ•°åŒ…æˆ–è®¢é˜…æœˆå¡"}
```

---

## ğŸ“¦ æ•°æ®åº“è¿ç§»

```bash
# æŸ¥çœ‹å½“å‰ç‰ˆæœ¬
docker-compose exec web alembic current

# è¾“å‡ºåº”è¯¥æ˜¾ç¤ºï¼š004

# æŸ¥çœ‹è¿ç§»å†å²
docker-compose exec web alembic history

# éªŒè¯æ–°è¡¨å·²åˆ›å»º
docker-compose exec postgres psql -U eduqr -d eduqr -c "\dt"

# åº”è¯¥çœ‹åˆ°ï¼š
# - users
# - quotas
# - orders
# - homework_items
```

---

## ğŸ¯ å•†ä¸šæ¨¡å¼

### å…è´¹ç‰ˆ
- æ¯å¤©10æ¬¡å…è´¹ç”Ÿæˆ
- é€‚åˆè½»åº¦ä½¿ç”¨

### æ¬¡æ•°åŒ…
- 100æ¬¡ / Â¥9.9
- æ°¸ä¹…æœ‰æ•ˆï¼ˆç›´åˆ°ç”¨å®Œï¼‰
- é€‚åˆå¶å°”ä½¿ç”¨

### æœˆå¡è®¢é˜…
- Â¥9.9 / æœˆ
- æ— é™æ¬¡ä½¿ç”¨
- è‡ªåŠ¨ç»­è´¹ï¼ˆv0.7.0å®ç°ï¼‰

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
/app
â”œâ”€â”€ quota.py                  # é¢åº¦ç®¡ç†é€»è¾‘ âœ¨æ–°å¢
â”œâ”€â”€ tasks.py                  # å®šæ—¶ä»»åŠ¡ âœ¨æ–°å¢
â”œâ”€â”€ models.py                 # æ•°æ®æ¨¡å‹ï¼ˆæ·»åŠ Quotaå’ŒOrderï¼‰
â”œâ”€â”€ main.py                   # æ·»åŠ é¢åº¦API
â”œâ”€â”€ alembic/versions/
â”‚   â”œâ”€â”€ 003_create_quotas.py  # åˆ›å»ºquotasè¡¨ âœ¨æ–°å¢
â”‚   â””â”€â”€ 004_create_orders.py  # åˆ›å»ºordersè¡¨ âœ¨æ–°å¢
â”œâ”€â”€ templates/
â”‚   â””â”€â”€ index.html            # æ·»åŠ é¢åº¦æ˜¾ç¤ºç»„ä»¶
â”œâ”€â”€ requirements.txt          # æ·»åŠ APScheduler
â””â”€â”€ .env.example              # æ·»åŠ é¢åº¦é…ç½®
```

---

## ğŸ”§ ç¯å¢ƒå˜é‡

åœ¨`.env`æ–‡ä»¶ä¸­æ·»åŠ ï¼š

```bash
# é¢åº¦ç®¡ç†é…ç½®
FREE_DAILY_LIMIT=10          # æ¯æ—¥å…è´¹æ¬¡æ•°ä¸Šé™
PACKAGE_PRICE_100=990        # 100æ¬¡ä»·æ ¼ï¼ˆåˆ†ï¼‰
MONTHLY_PRICE=990            # æœˆå¡ä»·æ ¼ï¼ˆåˆ†ï¼‰
```

---

## âš ï¸ å¸¸è§é—®é¢˜

### 1. å®šæ—¶ä»»åŠ¡ä¸æ‰§è¡Œ

**æ£€æŸ¥è°ƒåº¦å™¨çŠ¶æ€**ï¼š
```bash
curl http://localhost:8000/api/v1/scheduler/info

# é¢„æœŸå“åº”ï¼š
# {
#   "success": true,
#   "data": {
#     "running": true,
#     "jobs": [...]
#   }
# }
```

**è§£å†³**ï¼šé‡å¯åº”ç”¨å³å¯

### 2. é¢åº¦æ˜¾ç¤ºä¸æ­£ç¡®

**æ£€æŸ¥æ•°æ®åº“**ï¼š
```bash
docker-compose exec postgres psql -U eduqr -d eduqr -c "SELECT * FROM quotas WHERE user_id = 1;"
```

**è§£å†³**ï¼šæ£€æŸ¥quotaè¡¨çš„free_reset_dateæ˜¯å¦æ˜¯ä»Šå¤©

### 3. é¢åº¦ä¸è‡ªåŠ¨é‡ç½®

**åŸå› **ï¼šå®šæ—¶ä»»åŠ¡æœªå¯åŠ¨

**è§£å†³**ï¼š
1. æ£€æŸ¥startupäº‹ä»¶æ˜¯å¦è°ƒç”¨äº†start_scheduler()
2. æŸ¥çœ‹æ—¥å¿—æ˜¯å¦æœ‰"å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨å·²å¯åŠ¨"

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

- é¢åº¦æŸ¥è¯¢å“åº”æ—¶é—´ï¼š< 50ms
- é¢åº¦æ¶ˆè´¹å“åº”æ—¶é—´ï¼š< 100ms
- å®šæ—¶ä»»åŠ¡æ‰§è¡Œæ—¶é—´ï¼š< 5ç§’ï¼ˆé‡ç½®æ‰€æœ‰ç”¨æˆ·ï¼‰

---

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

**v0.3.0 - AIä½œä¸šç”Ÿæˆ**ï¼ˆé¢„è®¡3-4å¤©ï¼‰

- [ ] é›†æˆæ™ºè°±AI GLM-4 API
- [ ] å®ç°6ç§è‹±è¯­é¢˜å‹ç”Ÿæˆ
  - é€‰æ‹©é¢˜
  - å¡«ç©ºé¢˜
  - åˆ¤æ–­é¢˜
  - é˜…è¯»ç†è§£
  - å¬åŠ›é¢˜
  - ä½œæ–‡
- [ ] Promptå·¥ç¨‹ä¼˜åŒ–
- [ ] å‰ç«¯AIç”Ÿæˆç•Œé¢
- [ ] ç”Ÿæˆåè‡ªåŠ¨æ¶ˆè´¹é¢åº¦
- [ ] ç”Ÿæˆå†å²è®°å½•

---

## ğŸ“ æäº¤ä¿¡æ¯

```
commit 9c54492
Author: yangfanm4mini <yangfan@yangfanm4minideMac-mini.local>
Date:   Sat Feb 8 22:00:00 2026

Implement v0.2.0 - Quota Management System

- Quota management with free/purchased/subscription tiers
- Scheduled tasks for daily reset
- Orders table for payment tracking
- Frontend quota display component
```

---

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ä½¿ç”¨EduQR AIï¼å¦‚æœ‰é—®é¢˜ï¼Œè¯·æäº¤Issueæˆ–è”ç³»å¼€å‘è€…ã€‚

**GitHub**: https://github.com/ssdgjs/TeacherQRcode

**Tags**: `v0.2.0`, `quota`, `subscription`, `scheduled-tasks`
